<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Popup</title>
</head>
<body>
<p th:text="|판매자: + ${seller}|"></p>
<div id="chatMessages">
    <!-- 채팅 내용을 표시할 영역 -->
</div>
<form id="chatForm">
    <input type="text" id="messageInput" />
    <button type="button" onclick="sendMessage()">Send</button>
</form>

<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>
<script src="/webjars/sockjs-client/1.1.2/sockjs.min.js"></script>
<script src="/webjars/stomp-websocket/2.3.3-1/stomp.min.js"></script>
<script th:inline="javascript">
    var stompClient;

    function connectToChatRoom() {
        // stomp 연결 코드 작성 (채팅 방에 입장)
        // 서버로 sellerId와 buyerId를 전송하여 해당 채팅 방에 연결
        var sellerId = "판매자";
        var buyerId = "구매자";

        // WebSocket 연결
        var socket = new SockJS('/ws-chat');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            stompClient.subscribe('/topic/chat/' + sellerId + '/' + buyerId, function (message) {
                // 메시지를 받아서 처리하는 코드 작성
                var messageContent = JSON.parse(message.body).content;
                displayMessage(messageContent);
            });
        });
    }

    function displayMessage(messageContent) {
        // 채팅 창에 메시지를 표시하는 코드 작성
        var chatMessages = document.getElementById('chatMessages');
        var messageElement = document.createElement('div');
        messageElement.textContent = messageContent;
        chatMessages.appendChild(messageElement);
    }

    function sendMessage() {
        // 메시지를 서버로 전송하는 코드 작성
        var messageInput = document.getElementById('messageInput');
        var messageContent = messageInput.value;

        // 서버로 메시지 전송
        stompClient.send('/app/chat.sendMessage', {}, JSON.stringify({
            content: messageContent,
            senderId: "판매자";,
            receiverId: "2222";
        }));

        // 메시지 입력창 초기화
        messageInput.value = '';
    }

    // 연결된 채팅 방으로 바로 입장
    connectToChatRoom();
</script>
</body>
</html>