<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <meta charset="utf-8">
</head>

<body>
<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader"/>
    <form th:action="@{/items/add}" th:object="${item}" enctype="multipart/form-data" method="post">
        <!-- 위도 경도 히든 필드 -->
        <input type="hidden" th:field="*{latitude}" id="latitude" />
        <input type="hidden" th:field="*{longitude}" id="longitude" />
        <div>
            <label th:for="title">title</label>
            <input type="text" th:field="*{title}"
                   th:errorclass="field-error" class="form-control" placeholder="제목을 입력하세요">
            <div class="field-error" th:errors="*{title}">
                제목 오류
            </div>
        </div>
        <div>
            <label th:for="content">content</label>
            <textarea th:field="*{content}" th:errorclass="field-error" class="form-control" rows="3"
                      placeholder="상세설명을 입력하세요"></textarea>
            <div class="field-error" th:errors="*{content}">
                내용 오류
            </div>
        </div>
        <div>
            <label th:for="price">price</label>
            <input type="text" th:field="*{price}"
                   th:errorclass="field-error" class="form-control" placeholder="가격을 입력하세요">
            <div class="field-error" th:errors="*{price}">
                가격 오류
            </div>
        </div>
        <div>
            <ul>
                <li>이미지 파일들<input type="file" multiple="multiple" name="imageFiles"></li>
            </ul>
        </div>
        <div>
            <label for="itemTypeId">아이템 타입</label>
            <select id="itemTypeId" name="itemTypeId" th:field="*{itemTypeId}" required>
                <option th:each="itemType : ${itemTypes}"
                        th:value="${itemType.getItemTypeId()}"
                        th:text="${itemType.getDescription()}"></option>
            </select>
        </div>
        <div>
            <label for="saleStatus">판매 상태</label>
            <select id="saleStatus" name="saleStatus" th:field="*{saleStatus}" required>
                <option th:each="saleStatus : ${statuses}"
                        th:value="${saleStatus.getSaleStatusId()}"
                        th:text="${saleStatus.getDescription()}"></option>
            </select>
        </div>


        <div id="map" style="width:100%;height:350px;"></div>
        <p><em>거래 장소를 선택해주세요!</em></p>
        <div id="clickLatlng"></div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ef1254b7c0e4ca0bba75f337f56fe2aa"></script>
        <script>
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(36.35041273683429, 127.38483422584034), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

            // 지도에 확대 축소 컨트롤을 생성한다
            var zoomControl = new kakao.maps.ZoomControl();

            // 지도의 우측에 확대 축소 컨트롤을 추가한다
            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

            // 지도를 클릭한 위치에 표출할 마커입니다
            var marker = new kakao.maps.Marker({
                // 지도 중심좌표에 마커를 생성합니다
                position: map.getCenter()
            });
            // 지도에 마커를 표시합니다
            marker.setMap(map);

            // 지도에 클릭 이벤트를 등록합니다
            // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {

                // 클릭한 위도, 경도 정보를 가져옵니다
                var latlng = mouseEvent.latLng;

                // 마커 위치를 클릭한 위치로 옮깁니다
                marker.setPosition(latlng);

                // 위도와 경도 값을 갱신
                document.getElementById('latitude').value = latlng.getLat();
                document.getElementById('longitude').value = latlng.getLng();
            });
        </script>


        <input type="submit"/>
    </form>
    <br/>
    <div th:replace="fragments/footer :: footer"/>
</div> <!-- /container -->
</body>
</html>